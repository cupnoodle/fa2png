<!DOCTYPE html>
<html>
<head>
  <title>Font Awesome to PNG converter</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <script src="pablo.min.js"></script>
  <script src="icons.js"></script>

  <style>
    .choices__inner {
      min-height: 20px;
    }

    .container {
      margin-left: 20px;
      margin-right: 20px;
      display: grid;
      grid-template-columns: auto auto;
    }

    #canvas {
      background-color: #CCC;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="left">
    Font Awesome 2 PNG WIP
    <br><br>
    <div style="max-width: 300px;">
      <label>Icon Name</label>
      <br>
      <select id="icon-name" type="text" placeholder="flag-solid" onchange="updateCanvas()"></select>
    </div>

    <br><br>
    <label>Icon Size</label>
    <br>
    <input type="number" id="icon-size" value="100" max="999" pattern="\d*" onkeypress="return event.charCode >= 48 && event.charCode <= 57 && this.value.length < 3" onkeydown="changeCanvasSize()"/> px


    <br><br><br><br><br>

    <br><br><br><br><br>
    

    <br><br>
    <button onclick="download()">Download</button>
    </div>
    <div class="right">
      <div id="canvas" style="width: 100px; height: 100px;"></div>
    </div>
  </div>

  <script>
    var generated_icon;
    var filename = 'icon';
    var canvas = document.getElementById('canvas');
    var svgUrl;
    var svgText;

    function download(){
      generated_icon.download('png', filename + '.png');
    }

    var singleFetch = new Choices('#icon-name', {
        searchPlaceholderValue: 'icon name',
        renderChoiceLimit: '5'
      })
      .setChoices(function() {
        return fetch(
          'icons.json'
        )
          .then(function(response) {
            return response.json();
          })
          .then(function(data) {
            return data.map(function(icon) {
              return { label: icon.label, value: icon.id };
            });
          });
      });
    

    function updateCanvas() {
      const dropdown = document.querySelector('#icon-name');
      const selectedUrl = dropdown.value;

      if(selectedUrl.length == 0) {
        return;
      }

      const selectedText = dropdown.options[dropdown.selectedIndex].text;

      const size = document.getElementById('icon-size').value;

      if(size.length == ""){
        return;
      }
      
      filename = selectedText;
      canvas.innerHTML = "";

      Pablo(canvas).load('svgs/' + selectedUrl, function(icon){  
        icon.attr({width: size + 'px', height: size + 'px', fill: '#24B700'});
        
        generated_icon = icon;
      });
    }
    
    function changeCanvasSize() {
      setTimeout(function() {
        const size = document.getElementById('icon-size').value;
        const c = document.getElementById('canvas');
        c.style.width = size + 'px';
        c.style.height = size + 'px';

        updateCanvas();
      }, 10);
      
    }

  </script>
  
</body>
</html>