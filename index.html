<!DOCTYPE html>
<html>
<head>
  <title>Font Awesome to PNG converter</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <script src="pablo.min.js"></script>
  <script src="icons.js"></script>

  <style>
    .choices__inner {
      min-height: 20px;
    }

    .container {
      margin-left: 20px;
      margin-right: 20px;
      display: grid;
      grid-template-columns: auto auto;
    }

    .footer {
      margin-left: 20px;
      margin-right: 20px;
    }

    .right {
      margin-top: 3em;
    }

    @media only screen and (max-width: 500px) {
      .container {
        grid-template-columns: auto;
      }
    }

    #canvas {
      background-image: linear-gradient(45deg, #C6C6C6 25%, transparent 25%), linear-gradient(-45deg, #C6C6C6 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #C6C6C6 75%), linear-gradient(-45deg, transparent 75%, #C6C6C6 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="left">
    <h2>Font Awesome 2 PNG</h2>
    <br><br>
    <div style="max-width: 300px;">
      <label>Icon Name</label>
      <br>
      <select id="icon-name" type="text" placeholder="flag-solid" onchange="updateCanvas()"></select>
    </div>

    <br><br>
    <label>Icon Size</label>
    <br>
    <input type="number" id="icon-size" value="100" max="999" pattern="\d*" onkeypress="return event.charCode >= 48 && event.charCode <= 57 && this.value.length < 3" onkeydown="changeCanvasSizeAndColor()"/> px

    <br><br><br>
    <label>Icon Color</label>
    <br>
    <input type="color" id="icon-color" name="icon-color" value="#000000" onchange="changeCanvasSizeAndColor()"/>

    <br><br><br>
    <button onclick="download()">Download</button>
    </div>
    <div class="right">
      <div id="canvas" style="width: 100px; height: 100px;"></div>
    </div>
  </div>

  <div class="footer">
    <h2>FOOTER</h2>
  </div>

  <script>
    var generated_icon;
    var filename = 'icon';
    var canvas = document.getElementById('canvas');
    var svgUrl;
    var svgText;

    function download(){
      generated_icon.download('png', filename + '.png');
    }

    var singleFetch = new Choices('#icon-name', {
        searchPlaceholderValue: 'icon name',
        renderChoiceLimit: '5'
      })
      .setChoices(function() {
        return fetch(
          'icons.json'
        )
          .then(function(response) {
            return response.json();
          })
          .then(function(data) {
            return data.map(function(icon) {
              return { label: icon.label, value: icon.id };
            });
          });
      });
    

    function updateCanvas() {
      const dropdown = document.querySelector('#icon-name');
      const selectedUrl = dropdown.value;

      if(selectedUrl.length == 0) {
        return;
      }

      const selectedText = dropdown.options[dropdown.selectedIndex].text;

      const size = document.getElementById('icon-size').value;
      const color = document.getElementById('icon-color').value;

      if(size.length == ""){
        return;
      }
      
      filename = selectedText;
      canvas.innerHTML = "";

      Pablo(canvas).load('svgs/' + selectedUrl, function(icon){  
        icon.attr({width: size + 'px', height: size + 'px', fill: color});
        
        generated_icon = icon;
      });
    }
    
    function changeCanvasSizeAndColor() {
      setTimeout(function() {
        const size = document.getElementById('icon-size').value;
        const c = document.getElementById('canvas');
        c.style.width = size + 'px';
        c.style.height = size + 'px';

        updateCanvas();
      }, 10);
    }

  </script>
  
</body>
</html>